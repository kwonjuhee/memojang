## 4. Layout

렌더 트리가 생성되고 뷰포트내에서 **렌더러의 정확한 크기와 위치를 계산**하는 과정을 Layout(또는 Reflow)라고 한다. 모든 요소는 박스 형태로 되어있는데 박스의 크기와 위치, 높이를 계산하는 것.

모든 상대적인 측정값은 절대적인 픽셀로 변환된다.
(좌표계는 left -> X축, top -> Y축을 사용)

상위 렌더러에서 하위로 내려가면서 재귀적으로 계산한다.
(레이아웃이 필요한 자식 요소들의 layout 메서드를 호출)

1. 부모 렌더러가 자신의 너비를 계산
2. 부모가 자식 렌더러의 x, y 좌표를 배치한다.
3. 필요하다면(dirty이거나 global layout) 자식의 layout 메서드를 호출하여 자식의 높이를 계산한다.
4. 부모는 자식의 누적된 높이와 margin, padding을 사용하여 자신의 높이를 설정한다. 이 값은 부모의 부모가 사용하게 된다.
5. dirty bit flag를 제거한다.

> 🔎 Dirty bit system
>
> 작은 변경 사항으로 전체 레이아웃을 재배치하지 않기 위해 배치가 필요한 렌더러만 dirty bit flag를 표시하는 것을 말한다.
> 변경되었거나 추가된 렌더러와 그 자식을들 dirty로 지정한다.
>
> 두 가지 flag가 있다. => dirty, children are dirty

## 5. Paint

렌더 트리의 각 노드를 브라우저 화면에 픽셀로 나타내는 과정을 말한다.

렌더 트리가 탐색되고 렌더러의 paint 메서드가 호출된다.

https://web.dev/howbrowserswork/

## Layout과 Paint가 재실행되는 경우

- 렌더 트리가 재구성된다.

  - 자바스크립트에 의한 노드 추가 또는 삭제
  - 브라우저 창의 리사이징에 의한 뷰포트 크기 변경
  - HTML 요소의 레이아웃(위치, 크기)에 영향을 미치는 스타일 변경 (width/height, margin, padding, border, display, position, top/right/bottom/left 등)

- Repaint만 발생하는 경우
  - HTML 요소의 레이아웃에 영향을 미치지 않는 스타일 변경 (background-color, color, visibility, text-decoration 등)

https://docs.google.com/spreadsheets/u/0/d/1Hvi0nu2wG3oQ51XRHtMv-A_ZlidnwUYwgQsPQUg1R2s/pub?single=true&gid=0&output=html
