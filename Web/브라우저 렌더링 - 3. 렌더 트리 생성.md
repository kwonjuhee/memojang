## 3. 렌더 트리 구축

DOM 트리와 CSSOM 트리를 결합하여 표시해야할 순서대로 내용을 그려낼 수 있도록 렌더 트리를 구축한다.

이 과정을 WebKit에서는 attachment라 한다.

1. DOM 트리의 root에서 시작하여 visible 노드를 탐색한다.

2. 각 노드에 맞는 CSSOM 규칙을 찾아 적용한다.

3. 노드의 콘텐츠와 계산된 스타일과 함께 렌더 트리 구성 요소를 생성한다. 렌더 트리의 구성 요소를 WebKit에서는 renderer(render object), Gecko에서는 frame이라 한다.

4. 완성된 렌더 트리는 각 요소가 화면에 표시되는 위치를 계산하는 레이아웃에 사용되고 픽셀을 화면에 그리는 페인트 과정에도 사용된다.

```
class RenderObject{
  virtual void layout();
  virtual void paint(PaintInfo);
  virtual void rect repaintRect();
  Node* node;  //the DOM node
  RenderStyle* style;  // the computed style
  RenderLayer* containgLayer; //the containing z-index layer
}
```

### 💡 DOM 트리와 렌더 트리의 관계

렌더러는 DOM요소에 일치하지만 1:1 대응 관계는 아니다. 화면에 표시되지 않는 노드들은 렌더 트리에 반영되지 않기 때문.

- <head\> <srcipt\> <meta\> 등등
- `display: none`
  - ⚠️ `visibility: hidden`은 화면에 공간을 차지하기 때문에 렌더 트리에 포함된다.

html과 body 태그는 렌더 트리의 root render object가 된다. document가 가리키는 렌더 객체로 뷰포트 영역을 차지한다. (WebKit에서 RenderView라 부름)

float나 absolute, fixed positioned 요소는 DOM 트리와는 다른 부분에 배치되고 placeholder frame이 원래 있어야할 곳에 배치된다.

https://web.dev/howbrowserswork/

https://web.dev/critical-rendering-path-render-tree-construction/
