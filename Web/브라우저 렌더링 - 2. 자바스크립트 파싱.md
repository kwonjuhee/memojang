## 🔎 자바스크립트 엔진

자바스크립트 엔진은 자바스크립트 코드를 파싱하여 CPU가 이해할 수 있는 저수준 언어로 변환하고 실행하는 역할을 한다.

자바스크립트 엔진에는 구글 크롬과 Node.js의 V8, 파이어폭스의 SpiderMonkey, 사파리의 JavaScriptCore 등 다양한 종류가 있으며, 모든 자바스크립트 엔진은 ECMAScript 사양을 준수한다.

## 🤖 자바스크립트 파싱 과정

<p align="center">
  <img src="https://user-images.githubusercontent.com/62097867/210181273-1e8d4388-d351-4980-941e-fdf18e2fb77f.png" />
</p>

1. <script\> 태그를 만나면 DOM 생성을 일시 중단한다.

2. 자바스크립트 엔진에게 제어권이 넘어간다.

3. **토크나이징(Tokenizing)** : 자바스크립트 소스코드를 어휘 분석하여 문법적 의미를 갖는 최소 단위인 토큰들로 분해한다.

4. **파싱(Parsing)** : 토큰들의 집합을 구문 분석하여 **AST(Abstract Syntax Tree, 추상적 구문 트리)를 생성**한다.

5. 인터프리터가 AST를 기반으로 실행할 수 있는 중간 코드인 **바이트코드를 생성**한다.

6. 바이트코드를 실행하면서 해야하는 코드는 Optimized Machine Code, 즉 최적화된 코드로 다시 컴파일된다. 이 코드가 자주 사용되지 않으면 다시 Deoptimizing 되기도 한다.

7. 자바스크립트 파싱과 실행이 종료되면 다시 렌더링 엔진으로 제어권이 넘어가고 HTML 파싱이 중단된 지점부터 다시 파싱을 재개한다.

## 자바스크립트 파싱에 의한 HTML 파싱 중단

렌더링 엔진과 자바스크립트 엔진은 병렬적으로 파싱을 실행하지 않고 직렬적으로 수행한다.
따라서 script 태그의 위치에 따라 HTML 파싱이 블로킹되어 DOM 생성이 지연될 수 있기 때문에 script 태그의 위치가 중요하다.

다음과 같은 이유로 script 태그는 **body 요소의 가장 아래**에 위치시키는 것이 좋다.

- DOM이 완성되지 않은 상태에서 자바스크립트가 DOM을 조작하면 에러가 발생할 수 있다.
- 자바스크립트로 인해 HTML 요소들의 렌더링이 블로킹되지 않아 페이지 로딩 시간이 단축된다.

### async / defer 어트리뷰트

외부 자바스크립트 파일을 로드하는 경우 async와 defer 어트리뷰트를 사용하면
HTML 파싱과 외부 자바스크립트 파일의 로드가 비동기적으로 동시에 진행된다.

자바스크립트의 파싱과 실행 시점에서 차이가 있다.

<p align="center">
  <img src="https://user-images.githubusercontent.com/62097867/210182676-61162404-df75-49e7-bda9-ebbfe9c7098e.png" width="600px" />
</p>

**async 어트리뷰트**

- 자바스크립트의 파싱과 실행 시점: 자바스크립트의 로드가 완료된 직후
- script 태그의 순서와는 상관없이 로드가 완료된 자바스크립트부터 먼저 실행되므로 순서가 보장되지 않는다.

**defer 어트리뷰트**

- 자바스크립트의 파싱과 실행 시점: HTML 파싱이 완료된 직후, 즉 DOM 생성이 완료된 직후 (DOMContentLoaded 이벤트 발생)
- DOM 생성이 완료된 이후 실행되어야 할 자바스크립트에 유용하다.
