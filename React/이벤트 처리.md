## 합성 이벤트 (Synthetic Event)

React는 **크로스 브라우징을 위해** 브라우저 이벤트 객체를 한번 래핑한 `합성 이벤트(Synthetic Event)`를 사용한다.
(Native Event만으로는 모든 브라우저에서 일관되게 처리할 수 없다?)

이벤트 핸들러에 전달되는 이벤트 객체는 NativeEvent가 아닌 SyntheticEvent 객체이다!

- 앱이 실행되면 Native Event 목록을 이용해 React 이벤트 핸들러 프로퍼티와의 매핑 테이블을 생성한다. (ex. `onClick` - `click`)
- Native Event가 발생하면 Synthetic Event로 변환해줄 메서드, 즉 생성자도 미리 선언해둔다.

## React의 이벤트 처리 방식

React에서는 vanilla javascript 방식처럼 해당 요소에 이벤트 핸들러를 붙이는게 아니라 root 요소에 붙인다. (버블링, 이벤트 위임 방식)

> ⚠️ rootNode.addEventListener('click', handleClick); 이게 아니라 Native Event가 발생했을 때 다음과 같은 과정(3~5)을 거쳐 적절한 이벤트 핸들러들을 호출하는 리스너를 붙인다는 의미이다.

1. 앱이 시작되고 createRoot가 실행되면 모든 종류의 Native Event에 대해 루프를 돌면서 리스너를 root 요소에 붙인다.

2. Native Event가 발생하면 root에 붙여둔 이벤트 리스너가 이를 인지한다.

3. Native Event에 매핑되는 Synthetic Event로 변환한다.

4. 이벤트의 target Fiber 노드부터 root 노드까지 Fiber tree를 올라가며 Fiber 노드가 발생한 이벤트 타입에 맞는 이벤트 핸들러를 가지고 있다면 dispatchQueue에 넣는다.

5. root 노드에 도착하면 dispatchQueue를 순서대로 실행한다. 이때 Fiber 인스턴스가 중복인지 확인하고 stopPropagation 여부도 검사한다.

## stopPropagation 사용시 주의할 점

stopPropagation은 SyntheticEvent에서만 유효하다. Native Event가 DOM에서 버블링되는 것은 막을 수 없다.

```jsx
const App = () => {
  useEffect(() =>{
    document.addEventListener('click', () => console.log('document'));
  }, []);

  return (
  <div onClick={() => console.log('outer')}>
    <div onClick={(e) => {
      e.stopPropagation();
      console.log('inner');
    } />
  </div>
  );
}

// inner, document 출력
```

## React 17부터 달라진 점과 이유

<img src="https://user-images.githubusercontent.com/62097867/213772259-ee3a095e-70f5-4f03-bd86-82dc9c5249e5.png" width="600px" />

React 17부터 document가 아닌 root 요소에 이벤트 리스너를 붙이게 되었다.

이는 React와 non-React 또는 다른 버전의 React 코드 베이스를 합쳐서 사용해야 하는 경우에 각각 독립적으로 이벤트 핸들링을 처리하기 위해서이다.

https://github.com/facebook/react/pull/8117

https://medium.com/hcleedev/web-react%EC%9D%98-event-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EB%82%B4%EB%B6%80-%EA%B5%AC%ED%98%84-%EC%9E%90%EC%84%B8%ED%9E%88-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0-react-v18-2-0-39d59ab45bec

https://dev.to/romaintrotard/under-the-hood-of-event-listeners-in-react-4g01
